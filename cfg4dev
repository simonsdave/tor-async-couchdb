configure_dev_env()
{
    if [ ! -f "$PWD/requirements.txt" ]; then
        echo "Must source this script from repo's root directory"
        return 1
    fi

    if [ -d "$PWD/env" ]; then
        source "$PWD/env/bin/activate"
    else
        virtualenv env
        source "$PWD/env/bin/activate"

        pip install --requirement "$PWD/requirements.txt"
    fi

    export PATH=$PATH:"$PWD/bin"
    export PYTHONPATH="$PWD"

    STATUS_CODE=$(curl \
        -s \
        -o /dev/null \
        --write-out '%{http_code}' \
        http://127.0.0.1:5984)
    if [ $? -ne 0 ] || [ "$STATUS_CODE" != "200" ]; then
        docker run -d -p 5984:5984 --name couchdb couchdb
    fi

    return 0
}

configure_dev_env
